import{h as B,c as n,a as g,p as o,b as s,t as l,q as I,s as h,F as D,j as k,n as P,k as _,r as m,m as R,u as T,o as a}from"./index-D6XfGlWg.js";import{u as V}from"./news-DV7K8Qu6.js";import{u as H}from"./history-DpmIWw3s.js";import{u as $}from"./favorite-DUwoJoJa.js";import{u as j}from"./user-bSK34LHc.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as c}from"./function-call-DfxdXIrz.js";import"./index-C0Zqfgkc.js";import"./api-CqIw8Mru.js";import"./mount-component-CAUN_HIz.js";const z={class:"news-detail"},E={key:0,class:"detail-content"},M={class:"title-container"},U={class:"title"},G={class:"info"},J={key:0,class:"cover"},K=["src","alt"],O={class:"content"},Q={key:1,class:"related-news"},W={class:"related-list"},X=["onClick"],Y={class:"related-image"},Z=["src","alt"],ee={class:"related-title"},te={__name:"NewsDetail",setup(se){const y=R(),d=T(),e=V(),F=H(),i=$(),u=j(),v=_(()=>Number(y.params.id)),b=_(()=>e.newsDetail.content?e.newsDetail.content.split(`

`).filter(t=>t.trim()):[]),S=()=>{d.back()},N=t=>{d.push(`/news/detail/${t}`)},p=_(()=>i.isFavorite(v.value)),C=async()=>{if(!u.getLoginStatus){c({message:"请先登录后再收藏",position:"bottom"}),d.push("/login");return}const t=await i.toggleFavorite(e.newsDetail);t===!0?c({message:"已添加到收藏",position:"bottom"}):t===!1?c({message:"已取消收藏",position:"bottom"}):c({message:"操作失败，请稍后重试",position:"bottom"})};return B(async()=>{if(await e.getNewsDetail(v.value),e.newsDetail.id&&u.getLoginStatus)try{const t=await F.addHistoryApi(e.newsDetail.id);console.log("记录浏览历史API结果:",t)}catch(t){console.error("记录浏览历史API失败:",t)}if(i.loadFavorites(),u.getLoginStatus&&e.newsDetail.id){const t=await i.checkFavoriteStatusApi(e.newsDetail.id);t.success&&!t.isLocal&&(t.isFavorite&&!i.isFavorite(e.newsDetail.id)?i.addFavorite(e.newsDetail):!t.isFavorite&&i.isFavorite(e.newsDetail.id)&&i.removeFavorite(e.newsDetail.id))}}),(t,w)=>{const L=m("van-nav-bar"),x=m("van-button"),A=m("van-empty");return a(),n("div",z,[g(L,{title:"新闻详情","left-text":"返回","left-arrow":"",onClickLeft:S,fixed:""}),o(e).newsDetail.id?(a(),n("div",E,[s("div",M,[s("h1",U,l(o(e).newsDetail.title),1),g(x,{class:I(["favorite-btn",{"is-favorite":p.value}]),icon:p.value?"star":"star-o",onClick:C},null,8,["icon","class"])]),s("div",G,[s("span",null,l(o(e).newsDetail.author),1),s("span",null,l(o(e).newsDetail.publishTime),1),s("span",null,l(o(e).newsDetail.views)+" 阅读",1)]),o(e).newsDetail.image?(a(),n("div",J,[s("img",{src:o(e).newsDetail.image,alt:o(e).newsDetail.title},null,8,K)])):h("",!0),s("div",O,[(a(!0),n(D,null,k(b.value,(r,f)=>(a(),n("p",{key:f},l(r),1))),128))]),o(e).newsDetail.relatedNews?.length?(a(),n("div",Q,[w[0]||(w[0]=s("h3",null,"相关推荐",-1)),s("div",W,[(a(!0),n(D,null,k(o(e).newsDetail.relatedNews,r=>(a(),n("div",{class:"related-item",key:r.id,onClick:f=>N(r.id)},[s("div",Y,[s("img",{src:r.image,alt:r.title},null,8,Z)]),s("div",ee,l(r.title),1)],8,X))),128))])])):h("",!0)])):(a(),P(A,{key:1,description:"加载中..."}))])}}},me=q(te,[["__scopeId","data-v-e687bd09"]]);export{me as default};
