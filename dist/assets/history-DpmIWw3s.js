import{v as i}from"./index-D6XfGlWg.js";import{a as r}from"./index-C0Zqfgkc.js";import{u as o}from"./user-bSK34LHc.js";import{a}from"./api-CqIw8Mru.js";const h=i("history",{state:()=>({history:[]}),getters:{getHistory:s=>s.history},actions:{async addHistoryApi(s){const e=o();if(!e.getLoginStatus)return{success:!1,message:"请先登录"};try{const t=await r.post(`${a.baseURL}/api/history/add`,{newsId:s},{headers:{Authorization:e.token}});return t.data.code===200?{success:!0,data:t.data.data}:{success:!1,message:t.data.message||"添加浏览历史失败"}}catch(t){return console.error("添加浏览历史请求失败:",t),{success:!1,message:"网络请求失败"}}},addHistory(s){const e=this.history.findIndex(t=>t.id===s.id);e!==-1&&this.history.splice(e,1),this.history.unshift({...s,viewTime:new Date().toLocaleString()}),this.history.length>50&&this.history.pop(),this.saveHistory()},clearHistory(){this.history=[],this.saveHistory()},async clearHistoryApi(){const s=o();if(!s.getLoginStatus)return console.log("清空浏览历史API：用户未登录，使用本地操作"),this.clearHistory(),{success:!0,isLocal:!0};try{console.log("清空浏览历史API：开始请求");const e=await r.delete(`${a.baseURL}/api/history/clear`,{headers:{Authorization:s.token}});return e.data.code===200?(console.log("清空浏览历史API：清空成功"),this.clearHistory(),{success:!0}):(console.error("清空浏览历史API：请求失败",e.data.message),{success:!1,message:e.data.message||"清空浏览历史失败"})}catch(e){return console.error("清空浏览历史API：请求异常",e),{success:!1,message:"网络请求失败"}}},removeHistory(s){this.history=this.history.filter(e=>e.id!==s),this.saveHistory()},async removeHistoryApi(s){const e=o();if(!e.getLoginStatus)return console.log("删除浏览历史API：用户未登录，使用本地操作"),this.removeHistory(s),{success:!0,isLocal:!0};try{console.log("删除浏览历史API：开始请求",s);const t=await r.delete(`${a.baseURL}/api/history/delete/${s}`,{headers:{Authorization:e.token}});return t.data.code===200?(console.log("删除浏览历史API：删除成功"),this.removeHistory(s),{success:!0}):(console.error("删除浏览历史API：请求失败",t.data.message),{success:!1,message:t.data.message||"删除浏览历史失败"})}catch(t){return console.error("删除浏览历史API：请求异常",t),{success:!1,message:"网络请求失败"}}},saveHistory(){localStorage.setItem("news_history",JSON.stringify(this.history))},loadHistory(){const s=localStorage.getItem("news_history");s&&(this.history=JSON.parse(s))},async getHistoryListApi(){const s=o();if(!s.getLoginStatus)return console.log("获取浏览历史API：用户未登录，使用本地数据"),{success:!1,message:"请先登录",isLocal:!0};try{console.log("获取浏览历史API：开始请求");const e=await r.get(`${a.baseURL}/api/history/list`,{headers:{Authorization:s.token}});if(e.data.code===200){const t=e.data.data.list||[];return this.history=t,this.saveHistory(),{success:!0,data:t}}else return{success:!1,message:e.data.message||"获取浏览历史失败"}}catch{return{success:!1,message:"网络请求失败"}}}}});export{h as u};
