import{v as n}from"./index-D6XfGlWg.js";import{a as t}from"./index-C0Zqfgkc.js";import{a as r}from"./api-CqIw8Mru.js";const d=n("user",{state:()=>({userInfo:null,token:"",isLogin:!1,userBio:"这是我的个人简介"}),getters:{getUserInfo:s=>s.userInfo,getToken:s=>s.token,getLoginStatus:s=>s.isLogin,getUserBio:s=>s.userInfo?.bio||s.userBio},actions:{async login(s){try{const e=await t.post(`${r.baseURL}/api/user/login`,{username:s.username,password:s.password});if(e.data&&e.data.code===200){const a=e.data.data.userInfo,o=e.data.data.token;return this.userInfo=a,this.token=o,this.isLogin=!0,{success:!0,message:"登录成功"}}else return{success:!1,message:e.data.message||"登录失败"}}catch(e){return console.error("登录请求失败:",e),{success:!1,message:e.response?.data?.message||"登录请求失败，请稍后再试"}}},async register(s){try{const e=await t.post(`${r.baseURL}/api/user/register`,{username:s.username,password:s.password});if(e.data&&e.data.code===200){const a=e.data.data.userInfo,o=e.data.data.token;return this.userInfo=a,this.token=o,this.isLogin=!0,{success:!0,message:"注册成功"}}else return{success:!1,message:e.data.message||"注册失败"}}catch(e){return console.error("注册请求失败:",e),{success:!1,message:e.response?.data?.message||"注册请求失败，请稍后再试"}}},logout(){this.userInfo=null,this.token="",this.isLogin=!1},async getUserInfoDetail(){try{if(!this.token)return{success:!1,message:"未登录"};const s=await t.get(`${r.baseURL}/api/user/info`,{headers:{Authorization:this.token}});return s.data&&s.data.code===200?(this.userInfo=s.data.data,{success:!0,message:"获取用户信息成功",data:s.data.data}):{success:!1,message:s.data.message||"获取用户信息失败"}}catch(s){return console.error("获取用户信息请求失败:",s),{success:!1,message:s.response?.data?.message||"获取用户信息请求失败，请稍后再试"}}},async updateUserBio(s){try{if(!this.token)return{success:!1,message:"未登录"};const e=await t.put(`${r.baseURL}/api/user/update`,{bio:s},{headers:{Authorization:this.token}});return e.data&&e.data.code===200?(this.userInfo.bio=s,{success:!0,message:"更新个人简介成功"}):{success:!1,message:e.data.message||"更新个人简介失败"}}catch(e){return console.error("更新个人简介请求失败:",e),{success:!1,message:e.response?.data?.message||"更新个人简介请求失败，请稍后再试"}}},async updatePassword(s,e){try{if(!this.token)return{success:!1,message:"未登录"};const a=await t.put(`${r.baseURL}/api/user/password`,{oldPassword:s,newPassword:e},{headers:{Authorization:this.token}});return a.data&&a.data.code===200?{success:!0,message:"密码修改成功"}:{success:!1,message:a.data.message||"密码修改失败"}}catch(a){return console.error("修改密码请求失败:",a),{success:!1,message:a.response?.data?.message||"修改密码请求失败，请稍后再试"}}}},persist:{enabled:!0,strategies:[{key:"user-store",storage:localStorage}]}});export{d as u};
