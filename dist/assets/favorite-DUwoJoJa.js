import{v as c}from"./index-D6XfGlWg.js";import{a as i}from"./index-C0Zqfgkc.js";import{u as o}from"./user-bSK34LHc.js";import{a as r}from"./api-CqIw8Mru.js";const d=c("favorite",{state:()=>({favorites:[],loading:!1}),getters:{getFavorites:e=>e.favorites,isFavorite:e=>t=>e.favorites.some(s=>s.id===t)},actions:{async checkFavoriteStatusApi(e){const t=o();if(t.getLoginStatus)try{this.loading=!0;const s=await i.get(`${r.baseURL}/api/favorite/check`,{headers:{Authorization:t.token},params:{newsId:e}});return s.data.code===200?{success:!0,isFavorite:s.data.data.isFavorite}:{success:!1,message:s.data.message||"获取收藏状态失败"}}catch(s){return console.error("检查收藏状态请求失败:",s),{success:!0,isFavorite:this.isFavorite(e),isLocal:!0}}finally{this.loading=!1}else return console.log("用户未登录，返回本地状态"),{success:!0,isFavorite:this.isFavorite(e),isLocal:!0}},async addFavoriteApi(e){const t=o();if(!t.getLoginStatus)return{success:!1,message:"请先登录"};try{this.loading=!0;const s=await i.post(`${r.baseURL}/api/favorite/add`,{newsId:e},{headers:{Authorization:t.token}});return s.data.code===200?{success:!0,data:s.data.data}:{success:!1,message:s.data.message||"收藏失败"}}catch(s){return console.error("添加收藏请求失败:",s),{success:!1,message:"网络请求失败"}}finally{this.loading=!1}},async removeFavoriteApi(e){const t=o();if(!t.getLoginStatus)return{success:!1,message:"请先登录"};try{this.loading=!0;const s=await i.delete(`${r.baseURL}/api/favorite/remove?newsId=${e}`,{headers:{Authorization:t.token}});return s.data.code===200?{success:!0}:{success:!1,message:s.data.message||"取消收藏失败"}}catch(s){return console.error("取消收藏请求失败:",s),{success:!1,message:"网络请求失败"}}finally{this.loading=!1}},addFavorite(e){this.isFavorite(e.id)||(this.favorites.unshift({...e,favoriteTime:new Date().toLocaleString()}),this.saveFavorites())},removeFavorite(e){this.favorites=this.favorites.filter(t=>t.id!==e),this.saveFavorites()},async toggleFavorite(e){return!e||!e.id?(console.error("无效的新闻对象:",e),null):this.isFavorite(e.id)?(await this.removeFavoriteApi(e.id)).success?(this.removeFavorite(e.id),!1):null:(await this.addFavoriteApi(e.id)).success?(this.addFavorite(e),!0):null},clearFavorites(){this.favorites=[],this.saveFavorites()},async clearFavoritesApi(){const e=o();if(!e.getLoginStatus)return{success:!1,message:"请先登录"};try{this.loading=!0;const t=await i.delete(`${r.baseURL}/api/favorite/clear`,{headers:{Authorization:e.token}});return t.data.code===200?(this.clearFavorites(),{success:!0}):{success:!1,message:t.data.message||"清空收藏失败"}}catch(t){return console.error("清空收藏请求失败:",t),{success:!1,message:"网络请求失败"}}finally{this.loading=!1}},saveFavorites(){localStorage.setItem("news_favorites",JSON.stringify(this.favorites))},loadFavorites(){const e=localStorage.getItem("news_favorites");e&&(this.favorites=JSON.parse(e))},async getFavoriteListApi(e=1,t=10){const s=o();if(console.log("getFavoriteListApi开始执行",{isLoggedIn:s.getLoginStatus,token:s.token?"存在":"不存在"}),!s.getLoginStatus)return console.log("用户未登录，无法获取收藏列表"),{success:!1,message:"请先登录"};try{this.loading=!0,console.log("准备发送API请求",`${r.baseURL}/api/favorite/list`);const a=await i.get(`${r.baseURL}/api/favorite/list`,{headers:{Authorization:s.token},params:{page:e,pageSize:t}});return console.log("API响应数据:",a.data),a.data.code===200?(this.favorites=a.data.data.list,{success:!0,data:a.data.data}):{success:!1,message:a.data.message||"获取收藏列表失败"}}catch{return{success:!1,message:"网络请求失败"}}finally{this.loading=!1}}}});export{d as u};
