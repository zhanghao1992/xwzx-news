import{u as k}from"./user-bSK34LHc.js";import{h as C,c as B,a as n,b as P,w as c,u as z,r as u,k as g,e as d,A as o,o as D}from"./index-D6XfGlWg.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as v,b as m,s as i,c as x}from"./function-call-DfxdXIrz.js";import{s as b}from"./function-call-DjmNWhop.js";import"./index-C0Zqfgkc.js";import"./api-CqIw8Mru.js";import"./mount-component-CAUN_HIz.js";const T={class:"profile-page"},S={class:"profile-container"},L={__name:"Profile",setup(U){const h=z(),l=k();C(async()=>{if(!l.getLoginStatus){h.push("/login");return}try{const t=v({message:"加载中...",forbidClick:!0,duration:0}),e=await l.getUserInfoDetail();t.close(),e.success?console.log("获取用户信息成功:",l.userInfo):(console.error("获取用户信息失败:",e.message),m(e.message||"获取用户信息失败"))}catch(t){console.error("获取用户信息请求失败:",t),i.clear(),i.fail("获取用户信息失败")}});const _=g(()=>l.userInfo),w=g(()=>l.token?l.token.substring(0,5):""),f=g(()=>l.userInfo?.bio||"暂无简介"),y=()=>{const t=d(""),e=d(""),a=d("");b({title:"修改密码",showCancelButton:!0,className:"password-dialog",message:o("div",{style:"text-align: left; padding: 10px 0;"},[o("div",{style:"margin-bottom: 15px;"},[o("div",{style:"margin-bottom: 5px; text-align: left;"},"当前密码："),o("input",{type:"password",value:t.value,onInput:s=>{t.value=s.target.value},style:"width: 100%; border: 1px solid #dcdee0; border-radius: 4px; padding: 8px; box-sizing: border-box;"})]),o("div",{style:"margin-bottom: 15px;"},[o("div",{style:"margin-bottom: 5px; text-align: left;"},"新密码："),o("input",{type:"password",value:e.value,onInput:s=>{e.value=s.target.value},style:"width: 100%; border: 1px solid #dcdee0; border-radius: 4px; padding: 8px; box-sizing: border-box;"})]),o("div",{style:"margin-bottom: 15px;"},[o("div",{style:"margin-bottom: 5px; text-align: left;"},"确认密码："),o("input",{type:"password",value:a.value,onInput:s=>{a.value=s.target.value},style:"width: 100%; border: 1px solid #dcdee0; border-radius: 4px; padding: 8px; box-sizing: border-box;"})])])}).then(async()=>{if(!t.value){i("请输入当前密码");return}if(!e.value){i("请输入新密码");return}if(e.value!==a.value){i("两次密码输入不一致");return}try{const s=v({message:"修改中...",forbidClick:!0,duration:0}),r=await l.updatePassword(t.value,e.value);s.close(),r&&r.success?x("密码修改成功"):m(r&&r.message||"密码修改失败")}catch(s){console.error("修改密码失败:",s),i.clear(),i.fail("密码修改失败")}}).catch(()=>{})},I=()=>{const t=d(f.value);b({title:"修改个人简介",showCancelButton:!0,confirmButtonText:"确认",className:"bio-dialog",message:o("div",{style:"text-align: left; padding: 10px 0;"},[o("div",{style:"margin-bottom: 15px;"},[o("div",{style:"margin-bottom: 5px; text-align: left;"},"个人简介："),o("textarea",{value:t.value,onInput:e=>{t.value=e.target.value},style:"width: 100%; border: 1px solid #dcdee0; border-radius: 4px; padding: 8px; box-sizing: border-box; min-height: 100px; resize: vertical;"})])])}).then(async()=>{try{const e=v({message:"保存中...",forbidClick:!0,duration:0});console.log("更新个人简介:",t.value);const a=await l.updateUserBio(t.value);e.close(),a&&a.success?x("个人简介修改成功"):m(a&&a.message||"个人简介修改失败")}catch(e){console.error("更新个人简介失败:",e),i.clear(),i.fail("个人简介修改失败")}}).catch(()=>{})};return(t,e)=>{const a=u("van-nav-bar"),s=u("van-image"),r=u("van-cell"),p=u("van-cell-group");return D(),B("div",T,[n(a,{title:"个人信息","left-arrow":"",onClickLeft:e[0]||(e[0]=V=>t.$router.back()),fixed:""}),P("div",S,[n(p,{inset:"",class:"avatar-group"},{default:c(()=>[n(r,{title:"头像",center:""},{"right-icon":c(()=>[n(s,{round:"",width:"60",height:"60",src:"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg"})]),_:1})]),_:1}),n(p,{inset:"",class:"info-group"},{default:c(()=>[n(r,{title:"用户名",value:_.value.username||"admin"},null,8,["value"]),n(r,{title:"账号ID",value:`ID: heima-${w.value||"N/A"}`},null,8,["value"]),n(r,{title:"个人简介",value:f.value||"暂无简介","is-link":"",onClick:I},null,8,["value"])]),_:1}),n(p,{inset:"",class:"security-group"},{default:c(()=>[n(r,{title:"修改密码","is-link":"",onClick:y})]),_:1})])])}}},G=N(L,[["__scopeId","data-v-f65a63a1"]]);export{G as default};
